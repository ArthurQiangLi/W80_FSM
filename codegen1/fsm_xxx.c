/**
  ******************************************************************************
  * @file    ${XXX} STATE MACHINE
  * @author  Arthur, Waterloo
  * @version V1.0 
  * @date    $date
  * @brief   state machine flow chart is defined in this file.
  *
  *                      
  ******************************************************************************
  * @attention
  *         This file is generated by 'Codegen $version'.
  *
  ******************************************************************************
  */

/*******************************************************************************
************************************ Includes **********************************
*******************************************************************************/

#include "fsm_${xxx}.h"
#include "fsm_${xxx}_action.h"
#include "fsm_${xxx}_event.h"

#include "platform.h" //to use printf from c

/*******************************************************************************
******************************** Private typedef *******************************
*******************************************************************************/

/*******************************************************************************
******************************** Private define ********************************
*******************************************************************************/

/*******************************************************************************
********************************* Private macro ********************************
*******************************************************************************/

/*******************************************************************************
******************************* Private variables ******************************
*******************************************************************************/

static fsme_t _fsm_${xxx}_stru;

/*******************************************************************************
************************** Private function prototypes *************************
*******************************************************************************/

/*******************************************************************************
******************************* Private functions ******************************
*******************************************************************************/


/*******************************************************************************
  * @brief  Trans table
  *****************************************************************************/

$trans_table

/*******************************************************************************
  * @brief  SM Entire State Table
*   @note   keep the order the same with FSM_STATE_ENUM
  *****************************************************************************/
static const fsme_state_t _fsm_${xxx}_states_list[] =
{
    /* entry,               action,                     exit,                   event, event_num,                           name */
$state_table
};


/*******************************************************************************
  * @brief  fsm init
  * @param  *fsmp
  * @retval none
  * @note   sm entry portal.called by fsm_start()
  *****************************************************************************/
static void __${xxx}_fsm_entry(void *fsmp)
{
    fsme_t *fsm = (fsme_t *)fsmp; 
    
    fsm->name           = "${XXX}";
    fsm->states         = _fsm_${xxx}_states_list;
    fsm->states_nbr     = ARRAY_SIZE(_fsm_${xxx}_states_list);
    fsm->current_state  = ${XXX}_STATE_${STATE_0}, 
    fsm->trans          = _trans_${state_0};
    fsm->trans_nbr      = ARRAY_SIZE(_trans_${state_0});
    fsm->timeout        = 0;
    fsm->timeout_flag   = 0;
    fsm->ts_entry       = 0;
    fsm->self_exit_flag = 0;
    
    fsme_printf("Starting %s.", fsm->name);
}

/*******************************************************************************
******************************* Public functions *******************************
*******************************************************************************/


/*******************************************************************************
  * @brief  fsm start
  * @param  *fsmp
  * @retval none
  * @note   call this to start this sm.
  *****************************************************************************/
void fsm_${xxx}_start(void *fsmp)
{
    (void)fsmp; /* warning fix */
    fsme_t* fsm = &_fsm_${xxx}_stru;

    fsm->fsm_entry = __${xxx}_fsm_entry;
    fsm->fsm_exit  = 0;
    fsm_start(&_fsm_${xxx}_stru);
}


/*******************************************************************************
  * @brief  fsm polling
  * @param  *fsmp
  * @retval none
  *****************************************************************************/
void fsm_${xxx}_run(void *fsmp)
{
    fsmp = fsmp; /* warning fix */
    
    fsm_run(&_fsm_${xxx}_stru);
}

/*******************************************************************************
  * @brief  fsm stop
  * @param  *fsmp
  * @retval None
  * @note   [this function is not used]
  *****************************************************************************/
void fsm_${xxx}_stop(void *fsmp)
{
    fsmp = fsmp; /* warning fix */
    
    fsm_stop(&_fsm_${xxx}_stru);
}

/*******************************************************************************
  * @brief  get current sm state index
  * @param  *fsmp
  * @retval the state num
  *****************************************************************************/
int32_t fsm_${xxx}_get_current_state(void)
{
    return _fsm_${xxx}_stru.current_state;
}


/*******************************************************************************
  * @brief  get previous sm state index
  * @param  *fsmp
  * @retval the state num
  *****************************************************************************/
int32_t fsm_${xxx}_get_last_state(void)
{
    return _fsm_${xxx}_stru.last_state;
}

/*******************************************************************************
  * @brief  get state name string by state num
  * @param  state num
  * @retval string
  *****************************************************************************/
const char* fsm_${xxx}_get_state_string(int32_t state){
    return (const char*)(_fsm_${xxx}_states_list[state].name);
}



/********************************* end of file ********************************/

