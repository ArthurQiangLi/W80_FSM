/**
  ******************************************************************************
  * @file    LV0 STATE MACHINE
  * @author  Arthur, Waterloo
  * @version V1.0 
  * @date    2025-09-22
  * @brief   state machine flow chart is defined in this file.
  *
  *                      
  ******************************************************************************
  * @attention
  *         This file is generated by 'Codegen V1 20250918'.
  *
  ******************************************************************************
  */

/*******************************************************************************
************************************ Includes **********************************
*******************************************************************************/

#include "fsm_lv0.h"
#include "fsm_lv0_action.h"
#include "fsm_lv0_event.h"

#include "platform.h" //to use printf from c

/*******************************************************************************
******************************** Private typedef *******************************
*******************************************************************************/

/*******************************************************************************
******************************** Private define ********************************
*******************************************************************************/

/*******************************************************************************
********************************* Private macro ********************************
*******************************************************************************/

/*******************************************************************************
******************************* Private variables ******************************
*******************************************************************************/

static fsme_t _fsm_lv0_stru;

/*******************************************************************************
************************** Private function prototypes *************************
*******************************************************************************/

/*******************************************************************************
******************************* Private functions ******************************
*******************************************************************************/


/*******************************************************************************
  * @brief  Trans table
  *****************************************************************************/

static const fsme_trans_t _trans_sleep[] =
{
    {lv0_event_have_run_event1,        LV0_STATE_SLEEP},
};

static const fsme_trans_t _trans_run[] =
{
    {lv0_event_have_run_event1,        LV0_STATE_SLEEP},
};

static const fsme_trans_t _trans_stop[] =
{
    {lv0_event_have_run_event1,        LV0_STATE_SLEEP},
};

/*******************************************************************************
  * @brief  SM Entire State Table
*   @note   keep the order the same with FSM_STATE_ENUM
  *****************************************************************************/
static const fsme_state_t _fsm_lv0_states_list[] =
{
    /* entry,               action,                     exit,                   event, event_num,                           name */
    {lv0_sleep_entry,        lv0_sleep_action,            lv0_sleep_exit,          ARRAY_AND_SIZE(_trans_sleep),                "SLEEP"},
    {lv0_run_entry,        lv0_run_action,            lv0_run_exit,          ARRAY_AND_SIZE(_trans_run),                "RUN"},
    {lv0_stop_entry,        lv0_stop_action,            lv0_stop_exit,          ARRAY_AND_SIZE(_trans_stop),                "STOP"},
};


/*******************************************************************************
  * @brief  fsm init
  * @param  *fsmp
  * @retval none
  * @note   sm entry portal.called by fsm_start()
  *****************************************************************************/
static void __lv0_fsm_entry(void *fsmp)
{
    fsme_t *fsm = (fsme_t *)fsmp; 
    
    fsm->name           = "LV0";
    fsm->states         = _fsm_lv0_states_list;
    fsm->states_nbr     = ARRAY_SIZE(_fsm_lv0_states_list);
    fsm->current_state  = LV0_STATE_SLEEP, 
    fsm->trans          = _trans_sleep;
    fsm->trans_nbr      = ARRAY_SIZE(_trans_sleep);
    fsm->timeout        = 0;
    fsm->timeout_flag   = 0;
    fsm->ts_entry       = 0;
    fsm->self_exit_flag = 0;
    
    fsme_printf("Starting %s.", fsm->name);
}

/*******************************************************************************
******************************* Public functions *******************************
*******************************************************************************/


/*******************************************************************************
  * @brief  fsm start
  * @param  *fsmp
  * @retval none
  * @note   call this to start this sm.
  *****************************************************************************/
void fsm_lv0_start(void *fsmp)
{
    (void)fsmp; /* warning fix */
    fsme_t* fsm = &_fsm_lv0_stru;

    fsm->fsm_entry = __lv0_fsm_entry;
    fsm->fsm_exit  = 0;
    fsm_start(&_fsm_lv0_stru);
}


/*******************************************************************************
  * @brief  fsm polling
  * @param  *fsmp
  * @retval none
  *****************************************************************************/
void fsm_lv0_run(void *fsmp)
{
    fsmp = fsmp; /* warning fix */
    
    fsm_run(&_fsm_lv0_stru);
}

/*******************************************************************************
  * @brief  fsm stop
  * @param  *fsmp
  * @retval None
  * @note   [this function is not used]
  *****************************************************************************/
void fsm_lv0_stop(void *fsmp)
{
    fsmp = fsmp; /* warning fix */
    
    fsm_stop(&_fsm_lv0_stru);
}

/*******************************************************************************
  * @brief  get current sm state index
  * @param  *fsmp
  * @retval the state num
  *****************************************************************************/
int32_t fsm_lv0_get_current_state(void)
{
    return _fsm_lv0_stru.current_state;
}


/*******************************************************************************
  * @brief  get previous sm state index
  * @param  *fsmp
  * @retval the state num
  *****************************************************************************/
int32_t fsm_lv0_get_last_state(void)
{
    return _fsm_lv0_stru.last_state;
}

/*******************************************************************************
  * @brief  get state name string by state num
  * @param  state num
  * @retval string
  *****************************************************************************/
const char* fsm_lv0_get_state_string(int32_t state){
    return (const char*)(_fsm_lv0_states_list[state].name);
}



/********************************* end of file ********************************/

